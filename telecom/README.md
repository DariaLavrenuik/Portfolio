**Цель проекта.**
Целью проекта было создать модель, которая на основе поведения пользователя будет предсказывать уход клиента из компании. В качестве целевой метрики была выбрана AUC-ROC, таже принималось во внимание качество метрики accuracy, определяющая точность предсказаний модели.

**Описание услуг.**
Оператор предоставляет два основных типа услуг:

Стационарную телефонную связь. Возможно подключение телефонного аппарата к нескольким линиям одновременно. Интернет. Подключение может быть двух типов: через телефонную линию (DSL, от англ. digital subscriber line, «цифровая абонентская линия») или оптоволоконный кабель (Fiber optic). Также доступны такие услуги:

Интернет-безопасность: антивирус (DeviceProtection) и блокировка небезопасных сайтов (OnlineSecurity); Выделенная линия технической поддержки (TechSupport); Облачное хранилище файлов для резервного копирования данных (OnlineBackup); Стриминговое телевидение (StreamingTV) и каталог фильмов (StreamingMovies). За услуги клиенты могут платить каждый месяц или заключить договор на 1–2 года. Доступны различные способы расчёта и возможность получения электронного чека.

**Описание данных.**
Данные состоят из файлов, полученных из разных источников:

contract.csv — информация о договоре; personal.csv — персональные данные клиента; internet.csv — информация об интернет-услугах; phone.csv — информация об услугах телефонии. Во всех файлах столбец customerID содержит код клиента.

Информация о договорах актуальна на 1 февраля 2020.

В качестве сырых данных были 4 таблицы с различной информацией о клиентах оператора. personal - таблица с персональными данными клиентов, contract— информация о договоре, internet — информация об интернет-услугах, phone — информация об услугах телефонии.

На этапе загрузки и знакомств с данными:
Мы рассмотрели 4 таблицы с данными: contract, internet, personal, phone.

Общее количество клиентов - 7043 .

Явных пропусков и дубликатов не обнаружили.

EndDate – выделили как целевой признак.

После объединения таблиц появились пропущенные значения, так как не все клиенты пользовались услугами интернета/телефона. Из данных по таблице internet - 1526 шт, и 682 пропуска для столбца телефонии. Все они были обработаны на подходящие значения.

После первичного ознакомления с данными был намечен следующий план работы:
Произвести разведочный анализ данных: детальное знакомство с данными, поиск и обработка неочевидных пропусков, дубликатов, объединение таблиц;

Исследовательский анализ данных: анализ распределения ежемесячных платежей, оказанных пользователям услуг, построение графиков (гистограммы, бокс плоты, столбчатые диаграммы). Анализ периода, в который абоненты прекращали обслуживание. Оценка количества пользователей в зависимости от даты регистрации договора. Поиск закономерностей и выдвежение гипотез.

Подготовка признаков для обучения: исследование баланса классов, кодировка категориальных принаков, разделение на тренировочную и тестовую выборки;

Обучение моделей: обучение моделей при помощи кросс-валидации, подбор гиперпараметров и их оценка ROC-AUC, accuracy;

Сравнительный анализ моделей и поиск наилучшей;

**Общие выводы.**

На этапе предобработки данных:
Данные были объединены в одну таблицу, проанализированы и заполнены пропуски.

Дубликатов не выявлено, все записи уникальные.

Добавлен столбец с количеством дней, через которое клиент ушел.

Добавлен столбец с количеством дней от регистрации договора до даты сбора датасета - 2020-02-01.

Создан столбец с целевым признаком "left", в котором присвоили ушедшим 1, оставшимся клиентам 0.

Выводы по исследовательскому анализу данных.
Проанализировав общие данные о всех пользователях, были сделаны следующие выводы:

В разделе ежемесячных платежей нет выбросов, данные распределены нормально. В среднем пользователи платят 64.7, максимальная оплата 118.7, минимальная 18.2.

Большинство пользователей прекратило подписку в конце 2019, что совпадает с периодом активного роста заключения новых договоров.

После разбиения пользователей на ушедших и оставшихся:

Среди ушедших и оставшихся клиентов равное количество мужчин и женщин.

У 34% процентов оставшихся пользователей и у 18% ушедших есть дети.

Людей пенсионного возраста немного больше среди оставшихся абонентов 666 против 476.

Большинство пользователей уходят до года пользования услугами - около 304 дней.

У оставшихся: Медианная сумма платежа - 64.4. Большинство людей платят от 25 до 88. Данные немного скошены влево.

У ушедших: Медианная сумма платежа - 79.65. Большинство людей платят от 56 до 94. Данные немного скошены вправо

Уходить пользователи стали с конца 2019 года, или их уход не фиксировался.

55% всех пользователей используют оплату month-to-month.

Тип оплаты month-to-month использовали 88.5% ушедших клиентов. Среди оставшихся month-to-month-42.9%, one year - 31.8, two year - 25.3.

Среди ушедших клиентов только 12% использовали тип оплаты one year или two year.

Оставшиеся пользователи в равной степени используют все 4 метода оплаты.

Ушедшие абоненты: В основном пользовались оптоволоконным интернет соединением, стриминговыми сервисами, 50 % пользовались возможностью ведения параллельных линий во время звонка. Остальные виды услуг были непопулярны.

Оставшиеся: Пользуются в одинаковой мере DSL и оптоволоконным интернет соединением. Остальные признаки равно распределены по выборке.

Целевой признак 'left'.

На этапе обучения моделей:
Были отобраны следующие признаки:
1 Partner - находится ли в браке

2 Type - тип заключенного договора

3 PaymentMethod - вид оплаты

4 MonthlyCharges - сумма ежемесячных платежей

5 InternetService - пользуется ли абонент интернет услугами

6 TechSupport - тех поддержка

7 StreamingTV - пользуется ли абонент стриминговым телевидением

8 StreamingMovies - смотрит ли абонент стриминговыми видеосервисами

9 number_of_days - количество дней от регистрации пользователя до завершения обслуживания.

10 SeniorCitizen - имеет ли абонент пенсионное удостоверение.

Данные были разбиты на тренировочную и тестовую выборку в отношении 75/25. Обучение моделей проводилось на кросс-валидации, поэтому отдельно валидационную выборку не создавали. При изучении целевого признака был замечен дисбаланс классов в отношении 1:3. Было принято решение передавать моделям наименьший вес класса как приоритетный.

Для кодировки признаков были применены: standart scaler - для масштабирования численных признаков - 'MonthlyCharges', 'number_of_days' one hot encoder - для перевода категориальных признаков в численные - 'Partner', 'Type', 'PaymentMethod', 'InternetService', 'TechSupport', 'StreamingTV', 'StreamingMovies'.

С помощью подборщика параметров и кросс валидатора RandomizedSearchCV были отобраны и обучены 3 модели.

1. RandomForesClassifier
Наилучшими гиперпараметрами стали: 'randomforestclassifier__n_estimators': 250, 'randomforestclassifier__min_samples_split': 2, 'randomforestclassifier__min_samples_leaf': 2, 'randomforestclassifier__max_depth': 9.

Наилучшей метрикой на тренировочный выборке: 0.8537832925618059

2. LGBMClassifier
Наилучшими гиперпараметрами стали:'lgbmclassifier__num_leaves': 10, 'lgbmclassifier__max_depth': 60, 'lgbmclassifier__learning_rate': 0.5

Наилучшей метрикой на тренировочный выборке: 0.90

3. CatBoostClassifier
Наилучшими гиперпараметрами стали: 'catboostclassifier__verbose': False, 'catboostclassifier__learning_rate': 0.5, 'catboostclassifier__depth': 3

Наилучшей метрикой на тренировочный выборке: 0.92

Тестирование модели
Наилучшую метрику выдала модель CatBoostClassifier, протестировали ее на тестовой выборке. Получили следующие метрики:

ROC-AUC Catboost: 0.93 Accuracy Catboost: 0.88

Наиболее важными признаками для модели оказались длительность контракта и ежемесячные выплаты. Далее по важности - вид заключенного договора и наличие оптоволоконного интернета. Наименее значимые - стриминговые сервисы.
